---
title: "noaa_buoy"
author: "Cheryl Logan"
date: "4/17/2018"
output: html_document
---

Load libraries. Must first install tidyverse package if not already installed using `install.packages("tidyverse")`

```{r}
library(tidyverse) # install.packages("tidyverse")
```

Download 2017 noaa data (Station 46092 - MBM1)
http://www.ndbc.noaa.gov/station_history.php?station=46092

Open using tidyr function `read_table`

```{r}
buoy <-read_table2("46092h2017.txt")
```

Take a look at the data frame
```{r}
head(buoy) # view column headers
```


Combine header rows 1 & 2 by overwriting column names but separate using an underscore `_`
```{r}
## overwrite column names
names(buoy) <- str_c(names(buoy),                  ## current header
                  buoy %>% filter(`#YY` == "#yr"), ## row1 -- don't say buoy[1,] 
                  sep = "_")                       ## separate by `_`

## inspect
names(buoy) ## Looks a lot better
```
Clean up a bit more to get rid of the `#`s and the `/`s.

```{r}
names(buoy) <- str_replace_all(names(buoy), "#", "")  # replace `#` with nothing 
names(buoy) <- str_replace_all(names(buoy), "/", "_") # replace `/` with `_`

## inspect to make sure it worked
names(buoy)
```

Remove redundant 2nd row with units

```{r}
buoy <- buoy %>%
  filter(YY_yr != "#yr") # filter out row where YY_yr is equal to "#yr"

head(buoy)
```
Let's take a look at the distrubution of water temperatures

```{r}
ggplot(buoy, aes(WTMP_degC)) +
  geom_bar() +
  theme(axis.text.x = element_text(angle = 90)) # rotate x-axis labels 90 degrees
```


Water temperature is never going to be 999C, so here we begin to see that 99 or 999 are missing value codes. We can replace it with NA. Another issue is that the values are showing up as character strings rather than integers. Also need to fix this. Will do that later

First, let's unite year, month, and day into a single data value in buoy data.

```{r}
buoy <- buoy %>%
  unite(date, c(YY_yr, MM_mo, DD_dy), sep = "-") # concatenate contents of 3 columns into one column to join the two datasets using a unique ID
  
head(buoy)
```
Get mean daily water temp in 2017
```{r}
buoy_daily <- buoy %>%
  mutate(WTMP_degC_clean = gsub("99.0", NA, WTMP_degC), WSPD_m_s_clean = gsub("999.0", NA, WSPD_m_s)) %>% # make temp column numeric
  mutate(WTMP_degC_clean = as.numeric(WTMP_degC_clean), WSPD_m_s_clean = as.numeric(WSPD_m_s_clean)) %>%
  group_by(date) %>%
  summarize(mean_WTMP_degC_clean = mean(WTMP_degC_clean, na.rm=T), mean_WSPD_m_s_clean = mean(WSPD_m_s_clean, na.rm=T)) %>% # make
  ungroup()

head(buoy_daily)
```
Convert date column to a date object
```{r}
buoy_daily <- buoy_daily %>%
  mutate(date = as.Date(date, "%Y-%m-%d"))

head(buoy_daily)
```



Plot mean daily water temperature.
```{r}
ggplot(buoy_daily, aes(date,mean_WTMP_degC_clean)) +
  geom_point() +
  # theme(axis.text.x = element_text(angle = 90)) + # rotate x-axis labels 90 degrees
  xlab("Month") +
  ylab("Mean Daily Water Temp (degC)") +
  ggtitle("2017 M1 Buoy Data - Mean Daily Temperature") +
  scale_x_date(date_minor_breaks = "1 week", limits = as.Date(c('2017-05-01','2017-09-01'))) 

```

Plot mean daily wind speed.
```{r}
ggplot(buoy_daily, aes(date,mean_WSPD_m_s_clean)) +
  geom_point() +
  # theme(axis.text.x = element_text(angle = 90)) + # rotate x-axis labels 90 degrees
  xlab("Month") +
  ylab("Mean Daily Wind Speed (m/s)") +
  ggtitle("2017 M1 Buoy Data - Mean Daily Wind Speed") +
  scale_x_date(date_minor_breaks = "1 week", limits = as.Date(c('2017-05-01','2017-09-01'))) 

  
```